var d={TotalAmountLimit:"total-amount-limit",WorkdayDailyCount:"workday-daily-count",WorkdayMinMoney:"workday-min-money",WorkdayMaxMoney:"workday-max-money",WeekendDailyCount:"weekend-daily-count",WeekendMinMoney:"weekend-min-money",WeekendMaxMoney:"weekend-max-money",BeginDate:"begin-date",DateFormat:"date-format",IsFloat:"is-float",LangLocal:"lang-local",Currency:"currency",MoneySeparator:"money-separator",RemarkSeparator:"remark-separator",DataList:"data-list",TemplateDataItem:"template-data-item",PreviewTable:"preview-table",PreviewTableBody:"preview-table-body",PreviewTableRow:"template-preview-table-row",PreviewMoneysCol:"preview-moneys-col",PreviewRemarkCol:"preview-remark-col",TotalAmount:"total-amount",TotalCount:"total-count",CreateTime:"create-time",ExportType:"export-type"},w={LOCAL_LANG_WITH_WEEKDAY:"local-lang-with-weekday",DASH_FORMAT_WITH_WEEKDAY:"dash-format-with-weekday",SLASH_FORMAT_WITH_WEEKDAY:"slash-format-with-weekday",LOCAL_LANG_FORMAT:"local-lang-format",DASH_FORMAT:"dash-format",SLASH_FORMAT:"slash-format"},F={LONG_FORMAT:"long-format",SHORT_FORMAT:"short-format"},H={IMAGE:"image",EXCEL:"excel",TEXT:"text"},s={settings:{},dataList:[]};function K(){S(),Y()}document.addEventListener("DOMContentLoaded",K);function S(){let t={totalAmountLimit:"10000.00",workdayDailyCount:"1",workdayMinMoney:"300.00",workdayMaxMoney:"500.00",weekendDailyCount:"2",weekendMinMoney:"700.00",weekendMaxMoney:"1000.00",beginDate:ce(new Date),dateFormat:w.LOCAL_LANG_WITH_WEEKDAY,isFloat:!1},e={...t},n=document.getElementById(d.TotalAmountLimit),o=document.getElementById(d.WorkdayDailyCount),a=document.getElementById(d.WorkdayMinMoney),i=document.getElementById(d.WorkdayMaxMoney),r=document.getElementById(d.WeekendDailyCount),m=document.getElementById(d.WeekendMinMoney),h=document.getElementById(d.WeekendMaxMoney),l=document.getElementById(d.BeginDate),f=document.getElementById(d.DateFormat),p=document.getElementById(d.IsFloat),u=document.getElementById(d.LangLocal),T=document.getElementById(d.Currency),M=document.getElementById(d.MoneySeparator),y=document.getElementById(d.RemarkSeparator),g=document.getElementById(d.ExportType);n.value?e.totalAmountLimit=n.value:n.value=t.totalAmountLimit,o.value?e.workdayDailyCount=o.value:o.value=t.workdayDailyCount,a.value?e.workdayMinMoney=a.value:a.value=t.workdayMinMoney,i.value?e.workdayMaxMoney=i.value:i.value=t.workdayMaxMoney,r.value?e.weekendDailyCount=r.value:r.value=t.weekendDailyCount,m.value?e.weekendMinMoney=m.value:m.value=t.weekendMinMoney,h.value?e.weekendMaxMoney=h.value:h.value=t.weekendMaxMoney,l.value?e.beginDate=l.value:l.value=t.beginDate,f.value?e.dateFormat=f.value:f.value=t.dateFormat,p.checked?e.isFloat=p.checked:p.checked=t.isFloat,e.langLocal=u.value,e.currency=T.value,e.moneySeparator=M.value,e.remarkSeparator=y.value,e.exportType=g.value,s.settings=e}function X(){let t=parseFloat(s.settings.totalAmountLimit)||0,e=parseInt(s.settings.workdayDailyCount)||0,n=parseFloat(s.settings.workdayMinMoney)||0,o=parseFloat(s.settings.workdayMaxMoney)||0,a=parseInt(s.settings.weekendDailyCount)||0,i=parseFloat(s.settings.weekendMinMoney)||0,r=parseFloat(s.settings.weekendMaxMoney)||0,m=s.settings.beginDate,h=s.settings.dateFormat,l=s.settings.isFloat,f=s.settings.langLocal,p=[],u=new Date(m).getTime(),T=0;if(!(t<=0)){for(;T<t;){let M=new Date(u),y={millisecond:u,date:b(M,f,h),moneys:[]},g=[],c=0,E=!1;if(M.getDay()===0||M.getDay()===6?g=a<=0?[]:O(a,i,r,l):g=e<=0?[]:O(e,n,o,l),c=T+(g.length===0?0:g.reduce((k,A)=>k+A)),c>t){for(;g.length>0;){let k=g.pop();if(c-=k,c<=t)break}E=!0}if(E&&g.length===0||(T=c,y.moneys=g,p.push(y),E))break;u=new Date(M.getTime()+1440*60*1e3).getTime()}s.dataList=p}}function O(t,e,n,o){let a=()=>{let i=Math.random()*(n-e)+e;return o?Math.round(i*100)/100:Math.round(i)};return Array.from({length:t},()=>a())}function P(){let t=document.getElementById(d.DataList),e=document.getElementById(d.TemplateDataItem),n=s.settings.langLocal,o=s.settings.currency,a=s.settings.moneySeparator,i=s.settings.remarkSeparator;t.innerHTML="";for(let r of s.dataList){let m=e.content.cloneNode(!0),h=m.querySelector('label[for="money"]'),l=m.querySelector("input#money"),f=N(r.millisecond);h.setAttribute("for",f),h.innerHTML=r.date,l.id=f,l.value=r.moneys.map(p=>j(p,n,{currency:o})).join(a)+i,t.appendChild(m)}}function N(t){return`date-${t}`}function I(){let t=document.getElementById(d.PreviewTableBody),e=document.getElementById(d.PreviewTableRow),n=document.getElementById(d.PreviewMoneysCol),o=document.getElementById(d.PreviewRemarkCol),a=document.getElementById(d.TotalAmount),i=document.getElementById(d.TotalCount),r=document.getElementById(d.CreateTime),m=s.settings.dateFormat,h=s.settings.langLocal,l=s.settings.currency,f=s.settings.moneySeparator,p=s.settings.remarkSeparator,u=document.querySelectorAll(s.dataList.map(k=>`#${N(k.millisecond)}`).join(",")),T=null,M=null,y=0,g=0;t.innerHTML="";for(let k of u){let A=k.value,L=A.indexOf(p),D=L>=0?A.substring(0,L):A,v=L>=0?A.substring(L+1):"",B=D.split(f).map(R=>le(R,h,{currency:l})),W=e.content.cloneNode(!0),x=W.querySelectorAll("td");x[0].innerHTML=document.querySelector(`label[for="${k.id}"]`).innerHTML,x[1].innerHTML=D,x[2].innerHTML=v,T=T===null||D.length<T.length?D:T,M=M===null||v.length<M.length?v:M,y+=B.reduce((R,G)=>R+G*100,0),g+=B.length,t.appendChild(W)}let c={borderLeft:"1px solid #000",borderTop:"1px solid #000",padding:"0.2rem 0.4rem"},E=$(T,c),C=$(M,c);n.style.minWidth=`${E.width}px`,o.style.minWidth=`${C.width<40?40:C.width}px`,y=Math.round(y)/100,a.innerHTML=j(y,h,{currency:l}),i.innerHTML=g,r.innerHTML=b(new Date,h,m)+" "+se(new Date,h,F.SHORT_FORMAT)}function Y(){X(),P(),I()}function U(t){let e=0,n=0,o=[];t.querySelectorAll("col").forEach(c=>{e+=c.offsetWidth,o.push(c.offsetWidth)});let a=[],i=0;t.querySelectorAll("thead tr").forEach((c,E)=>{n+=c.offsetHeight,i+=c.offsetHeight,a.push({texts:c.innerText.split("	"),height:c.offsetHeight})});let r=[],m=0;t.querySelectorAll("tbody tr").forEach((c,E)=>{n+=c.offsetHeight,m+=c.offsetHeight,r.push({texts:c.innerText.split("	"),height:c.offsetHeight})});let h=[],l=0;t.querySelectorAll("tfoot tr").forEach((c,E)=>{n+=c.offsetHeight,l+=c.offsetHeight,h.push({texts:c.innerText.split("	"),height:c.offsetHeight})});let f=window.getComputedStyle(t.querySelector("td")),p={width:e,height:n,columns:o,theadRows:a,tbodyRows:r,tfootRows:h,tableTHeadHeight:i,tableTBodyHeight:m,tableTFootHeight:l,tableMargin:4,tableBorderColor:f.borderTopColor,tableBorderWidth:parseInt(f.borderTopWidth),textIndent:parseFloat(f.paddingLeft),fontColor:"#000000",fontSize:12,fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji"'},u=4,T=p.width+p.tableMargin*2,M=p.height+p.tableMargin*2,y=document.createElement("canvas"),g=y.getContext("2d");return y.width=T*u,y.height=M*u,y.style.width=`${T}px`,y.style.height=`${M}px`,y.style.position="absolute",y.style.top="0",y.style.left="0",y.style.zIndex="-9999",y.style.backgroundColor="#ffffff",document.body.appendChild(y),g.scale(u,u),g.clearRect(0,0,T,M),g.fillStyle="#ffffff",g.fillRect(0,0,T,M),g.textBaseline="middle",z(g,p),V(g,p),J(g,p),Q(g,p),y}function z(t,e){t.strokeStyle=e.tableBorderColor,t.lineWidth=e.tableBorderWidth,t.strokeRect(e.tableMargin,e.tableMargin,e.width,e.height),[].concat(e.theadRows,e.tbodyRows,e.tfootRows).forEach((i,r)=>{r!==0&&(t.moveTo(e.tableMargin,e.tableMargin+i.height*r),t.lineTo(e.tableMargin+e.width,e.tableMargin+i.height*r),t.stroke())});let n=e.tableMargin,o=e.theadRows[0].height,a=e.tableMargin;e.columns.forEach((i,r)=>{r!==e.columns.length-1&&(r===0?(t.moveTo(n+i,a+o),t.lineTo(n+i,a+e.height)):(t.moveTo(n+i,a+o),t.lineTo(n+i,a+e.height-e.tableTFootHeight)),t.stroke(),n+=i)})}function V(t,e){t.fillStyle=e.fontColor,t.font=`500 ${e.fontSize}px ${e.fontFamily}`,t.textAlign="center",e.theadRows.forEach((n,o)=>{if(n.texts.length===1)t.fillText(n.texts[0],e.tableMargin+e.width/2,e.tableMargin+n.height/2);else{let a=e.tableMargin;e.columns.forEach((i,r)=>{t.fillText(n.texts[r],a+i/2,e.tableMargin+n.height*o+n.height/2),a+=i})}})}function J(t,e){t.fillStyle=e.fontColor,t.font=`400 ${e.fontSize}px ${e.fontFamily}`;let n=e.tableMargin+e.tableTHeadHeight;e.tbodyRows.forEach((o,a)=>{let i=e.tableMargin;e.columns.forEach((r,m)=>{m===0?(t.textAlign="center",t.fillText(o.texts[m],i+r/2,n+o.height*a+o.height/2)):(t.textAlign="left",t.fillText(o.texts[m],i+e.textIndent,n+o.height*a+o.height/2)),i+=r})})}function Q(t,e){t.fillStyle=e.fontColor,t.font=`500 ${e.fontSize}px ${e.fontFamily}`;let n=e.tableMargin+e.tableTHeadHeight+e.tableTBodyHeight;e.tfootRows.forEach((o,a)=>{if(o.texts[0]&&(cellWidth=e.columns[0],t.textAlign="right",t.fillText(o.texts[0],e.tableMargin+cellWidth-e.textIndent,n+o.height*a+o.height/2)),o.texts[1]){let i=e.columns[0];t.textAlign="left",t.fillText(o.texts[1],e.tableMargin+i+e.textIndent,n+o.height*a+o.height/2)}})}function Z(t,e){let n=U(t),o=n.toDataURL("image/jpeg");document.body.removeChild(n),_(o,`${e}.jpg`)}function ee(t,e){let a=[];for(let h of t.querySelectorAll("tr")){let l=[],f=h.querySelectorAll("th,td");for(let p of f){let u=p.innerText.replace(/\u00A0/g," ").trim();u.includes('"')&&(u=u.replace(/"/g,'""')),(u.includes(",")||u.includes(`
`)||u.includes("\r")||u.includes('"'))&&(u=`"${u}"`),l.push(u)}a.push(l.join(","))}let i="\uFEFF"+a.join(`\r
`),r=new Blob([i],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(r);_(m,`${e}.csv`)}function te(t,e){let n=t.innerText.replace(/(\t)/g,"  "),o=new Blob([n],{type:"text/plain;charset=utf-8"}),a=URL.createObjectURL(o);_(a,`${e}.txt`)}function ne(t){s.settings.dateFormat=t.target.value,s.dataList.forEach(e=>{e.date=b(new Date(e.millisecond),s.settings.langLocal,s.settings.dateFormat)}),P(),I()}window.onDateFormatChange=ne;function oe(){S(),Y()}window.onCreateData=oe;function ae(){I()}window.onPreview=ae;function ie(t){s.settings.exportType=t.target.value}window.onExportTypeChange=ie;function re(){let t=document.getElementById(d.PreviewTable),e=t.querySelector("th:nth-child(1)").innerText,n=new Date,o=`${n.getFullYear()}${n.getMonth()+1}${n.getDate()}${n.getHours()}${n.getMinutes()}${n.getSeconds()}`,a=`${e}_${o}`.replace(/\s+/g,"_");switch(s.settings.exportType){case H.IMAGE:Z(t,a);break;case H.EXCEL:ee(t,a);break;case H.TEXT:default:te(t,a);break}}window.onExportData=re;function b(t,e=window.navigator.language,n=w.LOCAL_LANG_WITH_WEEKDAY){let o={};switch(n){case w.DASH_FORMAT_WITH_WEEKDAY:case w.SLASH_FORMAT_WITH_WEEKDAY:o={year:"numeric",month:"numeric",day:"2-digit",weekday:"short"};break;case w.LOCAL_LANG_FORMAT:o={year:"numeric",month:"short",day:"2-digit"};break;case w.DASH_FORMAT:case w.SLASH_FORMAT:o={year:"numeric",month:"numeric",day:"2-digit"};break;case w.LOCAL_LANG_WITH_WEEKDAY:default:o={year:"numeric",month:"short",day:"2-digit",weekday:"short"};break}let a=n===w.DASH_FORMAT_WITH_WEEKDAY||n===w.DASH_FORMAT,i=o.weekday!=="long"&&(o.month==="numeric"||o.month==="2-digit");return new Intl.DateTimeFormat(e,o).formatToParts(t).map(({type:l,value:f})=>{switch(l){case"literal":return a&&f==="/"?"-":f;case"weekday":return i?" "+f:f;default:return f}}).join("")}function se(t,e=window.navigator.language,n=F.LONG_FORMAT){let o={};switch(n){case F.SHORT_FORMAT:o={hourCycle:"h23",hour:"2-digit",minute:"2-digit"};break;case F.LONG_FORMAT:default:o={hourCycle:"h23",hour:"2-digit",minute:"2-digit",second:"2-digit"};break}return new Intl.DateTimeFormat(e,o).format(t)}var q=(t,e)=>new Intl.NumberFormat(t,{style:"currency",minimumFractionDigits:2,...e});function j(t,e=window.navigator.language,n){return q(e,n).format(t)}function le(t,e=window.navigator.language,n){let a=q(e,n).formatToParts(1234.56),i="",r="",m="";a.forEach(l=>{l.type==="currency"&&(i=l.value),l.type==="group"&&(r=l.value),l.type==="decimal"&&(m=l.value)});let h=t.replace(new RegExp(`\\${i}`),"").replace(new RegExp(`\\${r}`,"g"),"").replace(new RegExp(`\\${m}`),".");return parseFloat(h)}function ce(t){if(isNaN(t.getTime()))return"";let e=t.getFullYear(),n=t.getMonth()+1,o=t.getDate();return`${e}-${n<10?"0"+n:n}-${o<10?"0"+o:o}`}function $(t,e){let n=document.createElement("span");if(n.innerHTML=t,n.style.position="absolute",n.style.visibility="hidden",n.style.whiteSpace="nowrap",e)for(let a in e)n.style[a]=e[a];document.body.appendChild(n);let o=n.getBoundingClientRect();return document.body.removeChild(n),o}function _(t,e){let n=document.createElement("a");n.download=e,n.href=t,document.body.appendChild(n),n.click(),n.remove()}
